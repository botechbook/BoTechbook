# MSS 滑动窗口

MSS/滑动窗口

2014年7月24日

16:32

**TCP的MSS值**

TCP的MSS值是双方在建立连接时(3次握手)根据自身传输状况(例如网卡支持单帧大小,缓存大小等)所协商出来的单帧完整报文最大长度,一般在主机回应时就确定下来了,取两方的最小值一方,该值是放在TCP头的Option选项中.而UDP传输的MSS值是在应用层协商的,如TFTP协议.一般情况下MSS值是不能超过1518字节的,也就是网络传输中单个数据包不能大于1.48KB.

**TCP的滑动窗口**

Tcp滑动窗口值表示在指定的时间内,发送方可以发送窗口值大小的数据后才需要收到一个接收方的Ack包(但并不总是填满整个窗口值).因为如果每发送一个数据包就需要得到一个回应,在网络状况佳的情况下,这会浪费很多资源,所以,该值会通过接收方的Ack包动态调节,在网络空闲的状态下会加大窗口值,在网络忙的情况下会缩小,以确保数据能实时可靠地传输.该值一般是MSS值的倍数.因此滑动窗口是接收方的流量控制.

1.窗口的左边沿向右边沿靠近为窗口合拢,这种现象发生在数据被发送的确认时.

2.当窗口右边沿向右边移动时.将允许发送更多的数据,称为窗口张开,发生在另一端的接收进程读取已经确认的数据并释放了TCP的接收缓存时.

3.当右边沿向左移动时,称为窗口,不建议使用这种方式.

**TCP的拥塞窗口**

Tcp的拥塞窗口是发送方对流量的控制.发送方在初始化连接时拥塞窗口值为MSS值(以字节为单位),当收到接收方的Ack后,该值就会以指数增加一次,发送方会取滑动窗口和拥塞窗口的最小值作为发送上限.顺便说一下,滑动窗口和拥塞窗口是指TCP头的Window字段.滑动是指接收方发出的,拥塞是发送方发出的.

**MSS**

MSS 是TCP选项中最经常出现，也是最早出现的选项。MSS选项占4byte。MSS是每一个TCP报文段中数据字段的最大长度，注意：只是数据部分的字段，不包括TCP的头部。TCP在三次握手中，每一方都会通告其期望收到的MSS（MSS只出现在SYN数据包中）如果一方不接受另一方的MSS值则定位默认值536byte。

MSS值太小或太大都是不合适。太小，例如MSS值只有1byte，那么为了传输这1byte数据，至少要消耗20字节IP头部+20字节TCP头部=40byte，这还不包括其二层头部所需要的开销，显然这种数据传输效率是很低的。MSS过大，导致数据包可以封装很大，那么在IP传输中分片的可能性就会增大，接受方在处理分片包所消耗的资源和处理时间都会增大，如果分片在传输中还发生了重传，那么其网络开销也会增大。因此合理的MSS是至关重要的。MSS的合理值应为保证数据包不分片的最大值。对于以太网MSS可以达到1460byte.

不MSS相似的在IP层也有一个类似的概念---MTU（Maximum Transfer Unit）下图可以清晰翻译MSS与MTU 的关系：

![MSS%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%2008ef02c2abeb450289bef93afbf5651b/image1.jpg](MSS%20滑动窗口/image1.jpg)

MTU=MSS+TCP Header+IP Header.

事实是发送方和接收方存在很多中间设备，那MSS是如何协商的呢？

请看下图：

![MSS%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%2008ef02c2abeb450289bef93afbf5651b/image2.png](MSS%20滑动窗口/image2.png)